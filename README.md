# Пояснения к программе

«main.py» — это вспомогательная программа, исполняемая pyboard, которая принимает сообщения от малины и преобразует их в угол сервопривода и скорость двигателя.
Программы "qualification.py", "final1.py", "final2.py" загружаются на малину и имеют схожую структуру.
Все их можно разделить на 3 этапа работы:

1. ожидание кнопки
2. заезд
3. финиш

(в программе этапы определяются переменной «state»)

На первом этапе малина отправляет сообщение «999999999999999999999$», которое pyboard считывает и ждет изменения значения, параллельно отправляя показания кнопки.
Когда кнопка нажата, pyboard отправляет «1 $».
малина принимает это и переходит к следующему этапу.

Этап езды у каждой из программ отличается.

В "qualification.py" второй этап — это проезд с помощью пропорционально-дифференциального регулятора с двумя датчиками и с параллельным считыванием так называемых перекрёстков (оранжевая и синяя линии).
ПД-регулятор сначала вычисляет отклонение (e=dat1-dat2), а затем на его основе вычисляет управляющее воздействие (u = (e * kp + (e - e_old) * kd) (e_old - предыдущее отклонение).

"final1.py" работает аналогично "qualification.py", но выполняет другие задачи, например обезд кубов.
На этапе заезда на экране появляется новый огромный датчик (хотя на самом деле их два), который считывает кубики и возвращает их цвет и положение на камеру.
А если робот видит куб, то вычисляет новое отклонение (e = (240 + green_pos_x * 1,3) - green_pos_y (green_pos_y — позиция куба по y, а green_pos_x — позиция по x)), игнорируя черные линии.

«final2.py» — это улучшенная версия «final1.py».
В основном, добавлена улучшенная перспектива, а также полезные фичи, позволяющие улучшить результат посредством ускорения в зонах без кубиков.

Все предыдущие программы были для прохождения трассы, последующие программы нам необходимы для других целей.

«RobotAPI.py» создает класс, отвечающий за чтение камеры и в принципе работу малинки и возможность подключения к ней.

«start_robot.py» с использованием «RobotAPI.py» упрощает нам использование робота.
Компьютер подключен к малине по IP с использованием сети Wi-Fi.
В окне, созданном программой, наблюдаем 6 кнопок: «load start», «start», «stop», «raw», «video» и «connect to robot».
Если вы запустите «start_robot.py» и попытаетесь что-то сделать, программа напечатает сообщение «выберите робота» красным цветом.
Это означает, что прежде чем что-то загружать, нужно понять, куда это загружать.
В этом случае вы нажимаете на кнопку «connect to robot» и выбираете своего робота (предварительно необходимо подключиться к Wi-Fi нашего робота).
После этого заливаем на малину нужную программу (кнопка "load start") или, если она загрузилась, перезапускаем ее (кнопка "start").
Кнопкой «video» вы можете вывести видео с камеры робота на экран вашего ноутбука в отдельном окне.
В этом же окне будет отображаться телеметрия.
Кнопка «raw» запускает тестовый файл, отображающий просто видео с камеры без телеметрии.
Кнопка «stop» останавливает запущенную программу и вывод камеры.


# Подключаемся к пайборду

Для подключения к pyboard необходимо подключить micro usb кабель к компьютеру, и открыть pyboard как флешку в проводнике.
Во вкладке Pyboard будет два файла «main.py» и boot.py. файл «main.py» — это наша программа, которую будет выполнять pyboard.
Скопируйте этот файл в pycharm, при необходимости отредактируйте его и скопируйте обратно в pyboard.

# Подключение к raspberry pi

Подключение к малине немного сложнее, но если вы подключили pyboard, то будет проще.
Сначала нужно включить питание робота и дождаться, пока светодиод не загориться белым.
Это означает, что малина готова к работе и включила точку доступа.
После этого ищем сеть нашей малины и подключаемся к ней.
как только вы подключитесь к сети, вам нужно запустить программу «start_robot.py» на вашем компьютере.
Выберите своего робота.
Нажимаем «load start» и в окне с файлами выбираем подходящий.
Вуаля, ваша программа загружена и если на pyboard горят синий и желтый светодиоды, значит pyboard успешно получает сообщения от raspberry.

# Запуск программы на Raspberry Pi.

После того, как вы выбрали программу в «start_robot.py» (start_robot.py), программу можно запустить, нажав кнопку на роботе.
Но если вы выключили и включили робота, то ваша программа не запустится.
В этом случае запускается программа, которая прописана в "autostart.py".
Поэтому можно записать нужную программу в "autostart.py" и перезапускать программу через "start_robot.py" будет не нужно).

# Если что-то пойшло не так

если вы столкнулись с трудностями или робот не работает, то рекомендуется выполнить следующие действия.
В очень вероятной ситуации, когда IP компьютера и малины не совпадают и робот не подключается, сначала подключитесь к Wi-Fi сети вашей малины.
После этого откройте свойства сети и найдите там IP.
этот айпи нужно закинуть в "start_robot.py"(строка 2379).

Если робот работает неправильно, проверьте напряжение на вольтметре. Если оно ниже 5В, немедленно меняйте батарейки (рекомендуется менять батарейки, как только напряжение упадет до 7В).

Если ни на малине ни на пайборде не горит красный светодиод значит на них нет питания, в таком случае рекомендуется проверить подключение.



